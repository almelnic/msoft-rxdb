{"version":3,"file":"utils-hash.js","names":["sha256","jsSha256","input","Promise","resolve","nativeSha256","data","TextEncoder","encode","hashBuffer","crypto","subtle","digest","hash","Array","prototype","map","call","Uint8Array","x","toString","slice","join","canUseCryptoSubtle","defaultHashSha256","hashStringToNumber","str","nr","len","length","i","charCodeAt"],"sources":["../../../../src/plugins/utils/utils-hash.ts"],"sourcesContent":["import { sha256 } from 'ohash';\r\nimport type { HashFunction } from '../../types/index.d.ts';\r\n\r\n\r\n/**\r\n * TODO in the future we should no longer provide a\r\n * fallback to crypto.subtle.digest.\r\n * Instead users without crypto.subtle.digest support, should have to provide their own\r\n * hash function.\r\n */\r\nexport function jsSha256(input: string) {\r\n    return Promise.resolve(sha256(input));\r\n}\r\n\r\nexport async function nativeSha256(input: string) {\r\n    const data = new TextEncoder().encode(input);\r\n    const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n    /**\r\n     * @link https://jameshfisher.com/2017/10/30/web-cryptography-api-hello-world/\r\n     */\r\n    const hash = Array.prototype.map.call(\r\n        new Uint8Array(hashBuffer),\r\n        x => (('00' + x.toString(16)).slice(-2))\r\n    ).join('');\r\n    return hash;\r\n}\r\n\r\n\r\nexport const canUseCryptoSubtle = typeof crypto !== 'undefined' &&\r\n    typeof crypto.subtle !== 'undefined' &&\r\n    typeof crypto.subtle.digest === 'function';\r\n\r\n/**\r\n * Default hash method used to hash\r\n * strings and do equal comparisons.\r\n *\r\n * IMPORTANT: Changing the default hashing method\r\n * requires a BREAKING change!\r\n */\r\n\r\nexport const defaultHashSha256: HashFunction = canUseCryptoSubtle ? nativeSha256 : jsSha256;\r\n\r\n\r\nexport function hashStringToNumber(str: string): number {\r\n    let nr = 0;\r\n    const len = str.length;\r\n    for (let i = 0; i < len; i++) {\r\n        nr = nr + str.charCodeAt(i);\r\n        nr |= 0; // Convert to 32bit integer, improves performance\r\n    }\r\n    return nr;\r\n}\r\n"],"mappings":"AAAA,SAASA,MAAM,QAAQ,OAAO;AAI9B;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,QAAQA,CAACC,KAAa,EAAE;EACpC,OAAOC,OAAO,CAACC,OAAO,CAACJ,MAAM,CAACE,KAAK,CAAC,CAAC;AACzC;AAEA,OAAO,eAAeG,YAAYA,CAACH,KAAa,EAAE;EAC9C,IAAMI,IAAI,GAAG,IAAIC,WAAW,CAAC,CAAC,CAACC,MAAM,CAACN,KAAK,CAAC;EAC5C,IAAMO,UAAU,GAAG,MAAMC,MAAM,CAACC,MAAM,CAACC,MAAM,CAAC,SAAS,EAAEN,IAAI,CAAC;EAC9D;AACJ;AACA;EACI,IAAMO,IAAI,GAAGC,KAAK,CAACC,SAAS,CAACC,GAAG,CAACC,IAAI,CACjC,IAAIC,UAAU,CAACT,UAAU,CAAC,EAC1BU,CAAC,IAAK,CAAC,IAAI,GAAGA,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,EAAEC,KAAK,CAAC,CAAC,CAAC,CAC1C,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC;EACV,OAAOT,IAAI;AACf;AAGA,OAAO,IAAMU,kBAAkB,GAAG,OAAOb,MAAM,KAAK,WAAW,IAC3D,OAAOA,MAAM,CAACC,MAAM,KAAK,WAAW,IACpC,OAAOD,MAAM,CAACC,MAAM,CAACC,MAAM,KAAK,UAAU;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAO,IAAMY,iBAA+B,GAAGD,kBAAkB,GAAGlB,YAAY,GAAGJ,QAAQ;AAG3F,OAAO,SAASwB,kBAAkBA,CAACC,GAAW,EAAU;EACpD,IAAIC,EAAE,GAAG,CAAC;EACV,IAAMC,GAAG,GAAGF,GAAG,CAACG,MAAM;EACtB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,GAAG,EAAEE,CAAC,EAAE,EAAE;IAC1BH,EAAE,GAAGA,EAAE,GAAGD,GAAG,CAACK,UAAU,CAACD,CAAC,CAAC;IAC3BH,EAAE,IAAI,CAAC,CAAC,CAAC;EACb;EACA,OAAOA,EAAE;AACb","ignoreList":[]}