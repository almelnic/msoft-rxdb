{"version":3,"file":"dev-mode-tracking.js","names":["PREMIUM_FLAG_HASH","RXDB_UTILS_GLOBAL","RXDB_VERSION","defaultHashSha256","iframeShown","addDevModeTrackingIframe","db","window","location","premium","iframe","document","createElement","style","visibility","width","height","opacity","src","body","appendChild","isLocalHost","hostname","includes"],"sources":["../../../../src/plugins/dev-mode/dev-mode-tracking.ts"],"sourcesContent":["import type { RxDatabase } from '../../types';\r\nimport {\r\n    PREMIUM_FLAG_HASH,\r\n    RXDB_UTILS_GLOBAL,\r\n    RXDB_VERSION,\r\n    defaultHashSha256\r\n} from '../utils/index.ts';\r\n\r\n\r\nlet iframeShown = false;\r\n\r\n\r\n/**\r\n * Adds an iframe to track the results of marketing efforts.\r\n */\r\nexport async function addDevModeTrackingIframe(db: RxDatabase) {\r\n    /**\r\n     * Only run this in browser AND localhost AND dev-mode.\r\n     * Make sure this is never used in production by someone.\r\n     */\r\n    if (\r\n        iframeShown ||\r\n        typeof window === 'undefined' ||\r\n        typeof location === 'undefined'\r\n        // !isLocalHost()\r\n    ) {\r\n        return;\r\n    }\r\n\r\n\r\n    // do not show if premium flag is set.\r\n    if (\r\n        RXDB_UTILS_GLOBAL.premium &&\r\n        typeof RXDB_UTILS_GLOBAL.premium === 'string' &&\r\n        (await defaultHashSha256(RXDB_UTILS_GLOBAL.premium) === PREMIUM_FLAG_HASH)\r\n    ) {\r\n        return;\r\n    }\r\n\r\n    iframeShown = true;\r\n\r\n    const iframe = document.createElement('iframe');\r\n    /**\r\n     * Do not use display:none\r\n     * @link https://medium.com/@zachcaceres/dont-use-display-none-to-hide-iframes-in-safari-b51715eb22c4\r\n     */\r\n    iframe.style.visibility = 'hidden';\r\n    iframe.width = '1px';\r\n    iframe.height = '1px';\r\n    iframe.style.opacity = '0.1';\r\n    iframe.src = 'https://rxdb.info/html/dev-mode-iframe.html?version=' + RXDB_VERSION;\r\n    document.body.appendChild(iframe);\r\n}\r\n\r\n\r\nfunction isLocalHost() {\r\n    return (\r\n        location.hostname === 'localhost' ||\r\n        location.hostname.includes('localhost') ||\r\n        location.hostname === '127.0.0.1' ||\r\n        location.hostname === '0.0.0.0' ||\r\n        location.hostname === '[::1]'  // IPv6\r\n    );\r\n}\r\n"],"mappings":"AACA,SACIA,iBAAiB,EACjBC,iBAAiB,EACjBC,YAAY,EACZC,iBAAiB,QACd,mBAAmB;AAG1B,IAAIC,WAAW,GAAG,KAAK;;AAGvB;AACA;AACA;AACA,OAAO,eAAeC,wBAAwBA,CAACC,EAAc,EAAE;EAC3D;AACJ;AACA;AACA;EACI,IACIF,WAAW,IACX,OAAOG,MAAM,KAAK,WAAW,IAC7B,OAAOC,QAAQ,KAAK;EACpB;EAAA,EACF;IACE;EACJ;;EAGA;EACA,IACIP,iBAAiB,CAACQ,OAAO,IACzB,OAAOR,iBAAiB,CAACQ,OAAO,KAAK,QAAQ,IAC5C,OAAMN,iBAAiB,CAACF,iBAAiB,CAACQ,OAAO,CAAC,MAAKT,iBAAkB,EAC5E;IACE;EACJ;EAEAI,WAAW,GAAG,IAAI;EAElB,IAAMM,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;EAC/C;AACJ;AACA;AACA;EACIF,MAAM,CAACG,KAAK,CAACC,UAAU,GAAG,QAAQ;EAClCJ,MAAM,CAACK,KAAK,GAAG,KAAK;EACpBL,MAAM,CAACM,MAAM,GAAG,KAAK;EACrBN,MAAM,CAACG,KAAK,CAACI,OAAO,GAAG,KAAK;EAC5BP,MAAM,CAACQ,GAAG,GAAG,sDAAsD,GAAGhB,YAAY;EAClFS,QAAQ,CAACQ,IAAI,CAACC,WAAW,CAACV,MAAM,CAAC;AACrC;AAGA,SAASW,WAAWA,CAAA,EAAG;EACnB,OACIb,QAAQ,CAACc,QAAQ,KAAK,WAAW,IACjCd,QAAQ,CAACc,QAAQ,CAACC,QAAQ,CAAC,WAAW,CAAC,IACvCf,QAAQ,CAACc,QAAQ,KAAK,WAAW,IACjCd,QAAQ,CAACc,QAAQ,KAAK,SAAS,IAC/Bd,QAAQ,CAACc,QAAQ,KAAK,OAAO,CAAE;EAAA;AAEvC","ignoreList":[]}