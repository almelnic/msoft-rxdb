{"version":3,"file":"index.js","names":["_zSchema","_interopRequireDefault","require","_pluginHelpers","getValidator","schema","validatorInstance","ZSchema","validator","obj","validate","docData","useValidator","errors","getLastErrors","formattedZSchemaErrors","map","title","description","message","path","wrappedValidateZSchemaStorage","exports","wrappedValidateStorageFactory"],"sources":["../../../../src/plugins/validate-z-schema/index.ts"],"sourcesContent":["/**\r\n * this plugin validates documents before they can be inserted into the RxCollection.\r\n * It's using z-schema as jsonschema-validator\r\n * @link https://github.com/zaggino/z-schema\r\n */\r\nimport ZSchema from 'z-schema';\r\nimport type { RxJsonSchema } from '../../types/index.d.ts';\r\nimport { wrappedValidateStorageFactory } from '../../plugin-helpers.ts';\r\n\r\n\r\nexport function getValidator(\r\n    schema: RxJsonSchema<any>\r\n) {\r\n    const validatorInstance = new (ZSchema as any)();\r\n    const validator = (obj: any) => {\r\n        validatorInstance.validate(obj, schema);\r\n        return validatorInstance;\r\n    };\r\n    return (docData: any) => {\r\n        const useValidator = validator(docData);\r\n        if (useValidator === true) {\r\n            return;\r\n        }\r\n        const errors: ZSchema.SchemaErrorDetail[] = (useValidator as any).getLastErrors();\r\n        if (errors) {\r\n            const formattedZSchemaErrors = (errors as any).map(({\r\n                title,\r\n                description,\r\n                message,\r\n                path\r\n            }: any) => ({\r\n                title,\r\n                description,\r\n                message,\r\n                path\r\n            }));\r\n            return formattedZSchemaErrors;\r\n        } else {\r\n            return [];\r\n        }\r\n    };\r\n}\r\n\r\nexport const wrappedValidateZSchemaStorage = wrappedValidateStorageFactory(\r\n    getValidator,\r\n    'z-schema'\r\n);\r\n"],"mappings":";;;;;;;;AAKA,IAAAA,QAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,cAAA,GAAAD,OAAA;AAPA;AACA;AACA;AACA;AACA;;AAMO,SAASE,YAAYA,CACxBC,MAAyB,EAC3B;EACE,IAAMC,iBAAiB,GAAG,IAAKC,gBAAO,CAAS,CAAC;EAChD,IAAMC,SAAS,GAAIC,GAAQ,IAAK;IAC5BH,iBAAiB,CAACI,QAAQ,CAACD,GAAG,EAAEJ,MAAM,CAAC;IACvC,OAAOC,iBAAiB;EAC5B,CAAC;EACD,OAAQK,OAAY,IAAK;IACrB,IAAMC,YAAY,GAAGJ,SAAS,CAACG,OAAO,CAAC;IACvC,IAAIC,YAAY,KAAK,IAAI,EAAE;MACvB;IACJ;IACA,IAAMC,MAAmC,GAAID,YAAY,CAASE,aAAa,CAAC,CAAC;IACjF,IAAID,MAAM,EAAE;MACR,IAAME,sBAAsB,GAAIF,MAAM,CAASG,GAAG,CAAC,CAAC;QAChDC,KAAK;QACLC,WAAW;QACXC,OAAO;QACPC;MACC,CAAC,MAAM;QACRH,KAAK;QACLC,WAAW;QACXC,OAAO;QACPC;MACJ,CAAC,CAAC,CAAC;MACH,OAAOL,sBAAsB;IACjC,CAAC,MAAM;MACH,OAAO,EAAE;IACb;EACJ,CAAC;AACL;AAEO,IAAMM,6BAA6B,GAAAC,OAAA,CAAAD,6BAAA,GAAG,IAAAE,4CAA6B,EACtEnB,YAAY,EACZ,UACJ,CAAC","ignoreList":[]}